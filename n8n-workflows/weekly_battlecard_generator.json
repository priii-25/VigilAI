{
    "name": "VigilAI Weekly Battlecard Generator",
    "nodes": [
        {
            "parameters": {
                "rule": {
                    "interval": [
                        {
                            "field": "cronExpression",
                            "expression": "0 9 * * 1"
                        }
                    ]
                }
            },
            "name": "Weekly Monday 9AM",
            "type": "n8n-nodes-base.scheduleTrigger",
            "position": [
                250,
                300
            ]
        },
        {
            "parameters": {
                "url": "http://backend:8000/api/v1/competitors/?active=true",
                "options": {}
            },
            "name": "Get Active Competitors",
            "type": "n8n-nodes-base.httpRequest",
            "position": [
                450,
                300
            ]
        },
        {
            "parameters": {
                "functionCode": "// Prepare battlecard generation jobs\nconst competitors = $input.all();\nreturn competitors.map(item => ({\n  json: {\n    competitor_id: item.json.id,\n    name: item.json.name,\n    include_win_loss: true,\n    personalize_for: 'enterprise'\n  }\n}));"
            },
            "name": "Prepare Generation Jobs",
            "type": "n8n-nodes-base.function",
            "position": [
                650,
                300
            ]
        },
        {
            "parameters": {
                "url": "=http://backend:8000/api/v1/battlecards/{{ $json.competitor_id }}/generate",
                "method": "POST",
                "body": {
                    "include_win_loss": "={{ $json.include_win_loss }}",
                    "personalize_for": "={{ $json.personalize_for }}"
                },
                "options": {}
            },
            "name": "Generate Battlecard",
            "type": "n8n-nodes-base.httpRequest",
            "position": [
                850,
                300
            ]
        },
        {
            "parameters": {
                "url": "=http://backend:8000/api/v1/battlecards/{{ $json.battlecard_id }}/publish",
                "method": "POST",
                "options": {}
            },
            "name": "Publish to Notion",
            "type": "n8n-nodes-base.httpRequest",
            "position": [
                1050,
                300
            ]
        },
        {
            "parameters": {
                "url": "=http://backend:8000/api/v1/battlecards/{{ $json.battlecard_id }}/export-pdf",
                "method": "GET",
                "options": {}
            },
            "name": "Export PDF",
            "type": "n8n-nodes-base.httpRequest",
            "position": [
                1250,
                300
            ]
        },
        {
            "parameters": {
                "channel": "#sales-enablement",
                "text": "=ðŸ“Š Weekly Battlecard Update\n\nUpdated battlecards for {{ $json.competitor_count }} competitors.\n\nView in Notion: {{ $json.notion_url }}"
            },
            "name": "Notify Sales Team",
            "type": "n8n-nodes-base.slack",
            "position": [
                1450,
                300
            ]
        }
    ],
    "connections": {
        "Weekly Monday 9AM": {
            "main": [
                [
                    {
                        "node": "Get Active Competitors",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Get Active Competitors": {
            "main": [
                [
                    {
                        "node": "Prepare Generation Jobs",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Prepare Generation Jobs": {
            "main": [
                [
                    {
                        "node": "Generate Battlecard",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Generate Battlecard": {
            "main": [
                [
                    {
                        "node": "Publish to Notion",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Publish to Notion": {
            "main": [
                [
                    {
                        "node": "Export PDF",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Export PDF": {
            "main": [
                [
                    {
                        "node": "Notify Sales Team",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        }
    },
    "settings": {
        "saveExecutionProgress": true
    }
}