{
    "name": "VigilAI Competitor Monitoring Workflow",
    "nodes": [
        {
            "parameters": {
                "rule": {
                    "interval": [
                        {
                            "field": "hours",
                            "hoursInterval": 4
                        }
                    ]
                }
            },
            "name": "Schedule Trigger",
            "type": "n8n-nodes-base.scheduleTrigger",
            "position": [
                250,
                300
            ]
        },
        {
            "parameters": {
                "url": "http://backend:8000/api/v1/competitors/",
                "options": {}
            },
            "name": "Get Competitors",
            "type": "n8n-nodes-base.httpRequest",
            "position": [
                450,
                300
            ]
        },
        {
            "parameters": {
                "functionCode": "// Loop through competitors and trigger scrape\nconst competitors = $input.all();\nconst results = [];\n\nfor (const item of competitors) {\n  results.push({\n    json: {\n      competitor_id: item.json.id,\n      name: item.json.name,\n      domain: item.json.domain\n    }\n  });\n}\n\nreturn results;"
            },
            "name": "Prepare Scrape Jobs",
            "type": "n8n-nodes-base.function",
            "position": [
                650,
                300
            ]
        },
        {
            "parameters": {
                "url": "=http://backend:8000/api/v1/competitors/{{ $json.competitor_id }}/scrape",
                "method": "POST",
                "options": {}
            },
            "name": "Trigger Scrape",
            "type": "n8n-nodes-base.httpRequest",
            "position": [
                850,
                300
            ]
        },
        {
            "parameters": {
                "conditions": {
                    "boolean": [
                        {
                            "value1": "={{ $json.has_changes }}",
                            "value2": true
                        }
                    ]
                }
            },
            "name": "Has Changes?",
            "type": "n8n-nodes-base.if",
            "position": [
                1050,
                300
            ]
        },
        {
            "parameters": {
                "url": "http://backend:8000/api/v1/battlecards/generate",
                "method": "POST",
                "body": {
                    "competitor_id": "={{ $json.competitor_id }}"
                },
                "options": {}
            },
            "name": "Update Battlecard",
            "type": "n8n-nodes-base.httpRequest",
            "position": [
                1250,
                200
            ]
        },
        {
            "parameters": {
                "channel": "#competitive-intel",
                "text": "=ðŸ”” Competitor Update: {{ $json.name }}\n\nChanges detected:\n{{ $json.change_summary }}\n\nImpact: {{ $json.impact_score }}/10"
            },
            "name": "Notify Slack",
            "type": "n8n-nodes-base.slack",
            "position": [
                1250,
                400
            ]
        }
    ],
    "connections": {
        "Schedule Trigger": {
            "main": [
                [
                    {
                        "node": "Get Competitors",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Get Competitors": {
            "main": [
                [
                    {
                        "node": "Prepare Scrape Jobs",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Prepare Scrape Jobs": {
            "main": [
                [
                    {
                        "node": "Trigger Scrape",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Trigger Scrape": {
            "main": [
                [
                    {
                        "node": "Has Changes?",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Has Changes?": {
            "main": [
                [
                    {
                        "node": "Update Battlecard",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "Notify Slack",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        }
    },
    "settings": {
        "saveExecutionProgress": true,
        "saveDataErrorExecution": "all"
    }
}